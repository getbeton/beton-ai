# Commit 3.1: Improve Table Row Design and Actions

## Goal
Enhance the `TableRowComponent` implementation from the code snippet with better visual design and complete action functionality

## Dependencies
- Commit 1.1: Move tables to primary dashboard

## Files Modified
- `frontend/src/components/tables/TableRowComponent.tsx` (enhance existing from snippet)
- `frontend/src/components/tables/TableDashboard.tsx` (integrate enhanced actions)

## Implementation Steps

### Step 1: Enhance TableRowComponent from Code Snippet
```tsx
// Base implementation already exists in snippet:
const TableRowComponent: React.FC<{
  table: TableData;
  isSelected: boolean;
  onSelect: (id: string) => void;
  showBulkActions: boolean;
}> = ({ table, isSelected, onSelect, showBulkActions }) => {
  // Current features:
  // - Status icons (CheckCircle, Clock, AlertCircle)
  // - Responsive column visibility
  // - Dropdown actions menu
  // - Selection checkbox integration
  // - Hover states and selected states
};
```

### Step 2: Enhance Status Icon Implementation
```tsx
// Improve getStatusIcon function with more detailed states:
const getStatusIcon = (status: string) => {
  switch (status) {
    case "ready":
      return <CheckCircle className="h-4 w-4 text-green-500" />;
    case "processing":
      return <Clock className="h-4 w-4 text-yellow-500 animate-pulse" />;
    case "error":
      return <AlertCircle className="h-4 w-4 text-red-500" />;
    case "importing":
      return <Database className="h-4 w-4 text-blue-500 animate-pulse" />;
    default:
      return null;
  }
};

// Add status-specific row styling:
const getRowClassName = (status: string, isSelected: boolean): string => {
  const baseClasses = "hover:bg-muted/50 transition-colors";
  
  if (isSelected) {
    return `${baseClasses} bg-blue-50 hover:bg-blue-100`;
  }
  
  if (status === "error") {
    return `${baseClasses} bg-red-50/30 hover:bg-red-50`;
  }
  
  return baseClasses;
};
```

### Step 3: Improve Source Badge Styling
```tsx
// Enhance Badge component with source-specific colors:
const getSourceBadgeVariant = (source: TableData['source']) => {
  const variants = {
    'CSV': 'bg-blue-100 text-blue-800 border-blue-200',
    'Apollo': 'bg-green-100 text-green-800 border-green-200', 
    'Manual': 'bg-gray-100 text-gray-800 border-gray-200'
  };
  return variants[source] || variants['Manual'];
};

// Usage in component:
<Badge 
  variant="outline" 
  className={getSourceBadgeVariant(table.source)}
>
  {table.source}
</Badge>
```

### Step 4: Enhance Actions Dropdown with Real Functionality
```tsx
// Improve DropdownMenu with proper action handlers:
<DropdownMenuContent align="end">
  <DropdownMenuItem onClick={() => handleViewTable(table.id)}>
    <Eye className="h-4 w-4 mr-2" />
    View Table
  </DropdownMenuItem>
  <DropdownMenuItem 
    onClick={() => handleEditTable(table.id)}
    disabled={table.status === 'processing'}
  >
    <Edit className="h-4 w-4 mr-2" />
    Edit Structure
  </DropdownMenuItem>
  <DropdownMenuItem onClick={() => handleExportTable(table.id)}>
    <Download className="h-4 w-4 mr-2" />
    Export CSV
  </DropdownMenuItem>
  <DropdownMenuItem onClick={() => handleDuplicateTable(table.id)}>
    <Copy className="h-4 w-4 mr-2" />
    Duplicate
  </DropdownMenuItem>
  <DropdownMenuSeparator />
  <DropdownMenuItem 
    onClick={() => handleDeleteTable(table.id)}
    className="text-red-600 focus:text-red-600"
    disabled={table.status === 'processing'}
  >
    <Trash2 className="h-4 w-4 mr-2" />
    Delete
  </DropdownMenuItem>
</DropdownMenuContent>
```

### Step 5: Add Action Handler Functions
```tsx
// Add comprehensive action handlers to TableDashboard:
const handleViewTable = useCallback((tableId: string) => {
  router.push(`/dashboard/tables/${tableId}`);
}, [router]);

const handleEditTable = useCallback((tableId: string) => {
  router.push(`/dashboard/tables/${tableId}/edit`);
}, [router]);

const handleExportTable = useCallback(async (tableId: string) => {
  try {
    toast.loading('Preparing export...', { id: 'export' });
    const response = await apiClient.tables.export(tableId);
    
    if (response.success) {
      // Download file or show export modal
      toast.success('Export completed!', { id: 'export' });
    }
  } catch (error) {
    toast.error('Export failed', { id: 'export' });
  }
}, []);

const handleDuplicateTable = useCallback(async (tableId: string) => {
  try {
    toast.loading('Duplicating table...', { id: 'duplicate' });
    const response = await apiClient.tables.duplicate(tableId);
    
    if (response.success) {
      // Refresh table list
      toast.success('Table duplicated!', { id: 'duplicate' });
      // Add new table to state
    }
  } catch (error) {
    toast.error('Failed to duplicate table', { id: 'duplicate' });
  }
}, []);

const handleDeleteTable = useCallback(async (tableId: string) => {
  if (!confirm('Are you sure you want to delete this table? This action cannot be undone.')) {
    return;
  }
  
  try {
    toast.loading('Deleting table...', { id: 'delete' });
    const response = await apiClient.tables.delete(tableId);
    
    if (response.success) {
      setTables(prev => prev.filter(table => table.id !== tableId));
      toast.success('Table deleted successfully', { id: 'delete' });
    }
  } catch (error) {
    toast.error('Failed to delete table', { id: 'delete' });
  }
}, []);
```

### Step 6: Improve Table Cell Content Display
```tsx
// Enhance table cell content with better formatting:
<TableCell className="font-medium">
  <div className="flex items-center space-x-2">
    <span className="truncate max-w-[200px]">{table.name}</span>
    {getStatusIcon(table.status)}
    {table.status === 'processing' && (
      <span className="text-xs text-blue-600 font-medium">Processing...</span>
    )}
  </div>
  {table.description && (
    <p className="text-sm text-muted-foreground line-clamp-1 mt-1">
      {table.description}
    </p>
  )}
</TableCell>

// Enhanced row count with better formatting:
<TableCell className="hidden sm:table-cell">
  <div className="text-right">
    <span className="font-medium">{formatNumber(table.rows)}</span>
    <span className="text-sm text-muted-foreground ml-1">rows</span>
  </div>
</TableCell>

// Enhanced column count:
<TableCell className="hidden md:table-cell">
  <span className="text-muted-foreground">{table.columns} columns</span>
</TableCell>
```

### Step 7: Add Processing State Overlays
```tsx
// Add processing overlay for tables being processed:
{table.status === 'processing' && (
  <div className="absolute inset-0 bg-white/60 flex items-center justify-center">
    <div className="flex items-center space-x-2 bg-blue-50 px-3 py-1 rounded-full">
      <Clock className="h-4 w-4 text-blue-500 animate-pulse" />
      <span className="text-sm font-medium text-blue-700">Processing</span>
    </div>
  </div>
)}
```

## Acceptance Criteria

✅ **Enhanced Visuals**: Table rows have improved styling with proper status colors
✅ **Status Indicators**: Clear visual indicators for ready, processing, error, importing states  
✅ **Source Badges**: Colored badges for CSV (blue), Apollo (green), Manual (gray)
✅ **Action Menu**: Complete dropdown with View, Edit, Export, Duplicate, Delete
✅ **Responsive Design**: Maintains existing responsive column behavior
✅ **Interactive States**: Proper hover, selected, and disabled states

## QA Testing Checklist

### Visual Design Enhancement
- [ ] Table rows have clean, modern appearance
- [ ] Status icons clearly visible and appropriately colored
- [ ] Source badges use distinct colors (CSV=blue, Apollo=green, Manual=gray)
- [ ] Selected rows have blue background highlighting
- [ ] Error state rows have subtle red background
- [ ] Processing overlay shows on processing tables

### Status Icon Implementation
- [ ] Ready state: Green CheckCircle icon
- [ ] Processing state: Yellow Clock icon with pulse animation
- [ ] Error state: Red AlertCircle icon
- [ ] Importing state: Blue Database icon with pulse animation
- [ ] Icons properly sized (h-4 w-4) and positioned

### Actions Dropdown Functionality
- [ ] "View Table" navigates to table detail page
- [ ] "Edit Structure" navigates to table edit page
- [ ] "Export CSV" triggers download/export process
- [ ] "Duplicate" creates copy of table
- [ ] "Delete" shows confirmation and removes table
- [ ] Actions disabled appropriately for processing tables

### Responsive Behavior
- [ ] Mobile (320px+): Name and Actions columns visible
- [ ] Tablet (768px+): + Rows and Last Modified columns visible
- [ ] Desktop (1024px+): + Columns and Source columns visible
- [ ] Large screens (1280px+): All columns visible with optimal spacing
- [ ] Table scrolls horizontally when content overflows

### Content Display Improvements
- [ ] Table names truncate properly when too long
- [ ] Row counts formatted with thousands separators
- [ ] Column counts show as "X columns"
- [ ] Descriptions truncate with line-clamp-1
- [ ] Last modified shows relative time format

### Interactive States
- [ ] Hover states show subtle background change
- [ ] Selected state shows blue background
- [ ] Processing tables show overlay with status
- [ ] Disabled actions appear grayed out
- [ ] Dropdown menu opens/closes properly

### Action Handler Integration
- [ ] All action handlers properly integrated with existing API
- [ ] Loading states show during async actions
- [ ] Success/error toast notifications work
- [ ] Table list updates after successful actions
- [ ] Error handling shows appropriate messages

### Performance Considerations
- [ ] Row rendering optimized for large table lists
- [ ] Status icon calculations don't cause lag
- [ ] Action handlers use proper useCallback optimization
- [ ] No unnecessary re-renders on state changes

## Definition of Done
- [ ] TableRowComponent enhanced with improved visuals
- [ ] Status icons implemented with proper animations
- [ ] Source badges styled with distinct colors
- [ ] Action dropdown fully functional with real handlers
- [ ] Responsive design maintained and improved
- [ ] Processing states clearly indicated
- [ ] Error and success states properly handled
- [ ] Ready for commit 3.2 (bulk selection integration) 